#!/bin/env zsh

gclone() {
    local YOUR_USERNAME="kkalkounos"
    local UPSTREAM_OWNER="SymphonyOSF"

    _gclone_error() {
        echo "‚ùå Error: $1" >&2
        return 1
    }

    (( $# != 1 )) && _gclone_error "Usage: gclone <repo-name>"

    local REPO_NAME="$1"

    [ -d "$REPO_NAME" ] && _gclone_error "A directory named '$REPO_NAME' already exists."

    if ! gh auth status &> /dev/null; then
        if ! command -v gh &> /dev/null; then
            _gclone_error "GitHub CLI ('gh') not found. Please install it from https://cli.github.com/"
        else
            _gclone_error "Not logged into the GitHub CLI. Please run 'gh auth login'."
        fi
    fi

    echo "‚ñ∂Ô∏è  Checking for fork '$YOUR_USERNAME/$REPO_NAME'..."
    if ! gh repo view "$YOUR_USERNAME/$REPO_NAME" &> /dev/null; then
        echo "üîé Fork not found. Creating it from '$UPSTREAM_OWNER/$REPO_NAME'..."
        gh repo fork "$UPSTREAM_OWNER/$REPO_NAME" --clone=false || _gclone_error "Failed to fork the repository."
        echo "‚úÖ Fork created successfully."
    else
        echo "üëç Fork already exists."
    fi

    echo "‚ñ∂Ô∏è  Cloning your fork 'git@github.com:$YOUR_USERNAME/$REPO_NAME.git'..."
    git clone "git@github.com:$YOUR_USERNAME/$REPO_NAME.git" || _gclone_error "Failed to clone your fork."

    cd "$REPO_NAME" || _gclone_error "Could not change into the '$REPO_NAME' directory."

    echo "‚ñ∂Ô∏è  Adding upstream remote 'git@github.com:$UPSTREAM_OWNER/$REPO_NAME.git'..."
    git remote add upstream "git@github.com:$UPSTREAM_OWNER/$REPO_NAME.git" || _gclone_error "Failed to add the upstream remote."

    echo "‚úÖ Setup complete for '$REPO_NAME'."
    echo "   Remotes configured:"
    git remote -v
}
